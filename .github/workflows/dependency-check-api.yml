name: Branch CI for API

on: [ pull_request ]

jobs:
  api:
    name: API SCA
    runs-on: ubuntu-latest

    steps:
      - name: Checkout 🛎️
        uses: actions/checkout@v2

      - name: Setup Node ☕
        uses: actions/setup-node@v1
        with:
          node-version: 14.x

      - name: Dependency Check 🐛
        run: |
          cd api
          wget https://github.com/jeremylong/DependencyCheck/releases/download/v7.2.1/dependency-check-7.2.1-release.zip
          unzip dependency-check-7.2.1-release.zip
          dependency-check/bin/dependency-check.sh --out=./dependency-check-reports --scan package.lock -f HTML -f JSON --failOnCVSS 8 --project="snnap api" --data=/tmp/dependency-check-data --suppression suppressions.xml

      - name: Publish Result
        if: always()
        uses: actions/upload-artifact@v2
        with:
          name: OWASP Dependency Check API Results
          path: dependency-check-reports